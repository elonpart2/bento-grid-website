"use client";

import { useEffect, useRef, useState } from "react";

import Widget from "../components/Widget";
import { widgets } from "./widgets";

import Partners from "@/components/Partners";
import About from "@/components/About";
import UpcomingSessions from "@/components/UpcommingSessions";
import PricingPlans from "@/components/PricingPlans";
import FundsAccessibility from "@/components/FundsAccessibility";
import Sponsors from "@/components/Sponsors";
import Locations from "@/components/Locations";
import Reviews from "@/components/Reviews";
import FAQ from "@/components/FAQ";
import ContactForm from "@/components/ContactForm";
import Footer from "@/components/Footer";
import NavBar from "@/components/NavBar";

export default function HomePage() {
  const [visibleCount, setVisibleCount] = useState(6);
  const [showCanvas, setShowCanvas] = useState(false);
  const loadMoreRef = useRef(null);
  const tileRefs = useRef([]);
  const sectionRefs = useRef([]);
  const canvasRef = useRef(null);

  const heroRef = useRef(null); // <-- hero section ref

  // Add sections refs
  const addToSectionRefs = (el) => {
    if (el && !sectionRefs.current.includes(el)) {
      sectionRefs.current.push(el);
    }
  };

  // Insert heroRef at start of sectionRefs on mount
  useEffect(() => {
    if (heroRef.current && !sectionRefs.current.includes(heroRef.current)) {
      sectionRefs.current = [heroRef.current, ...sectionRefs.current];
    }
  }, []);

  // Canvas animation setup
  useEffect(() => {
    const canvas = canvasRef.current;
    const ctx = canvas.getContext("2d");
    const dpr = window.devicePixelRatio || 1;

    const setSize = () => {
      const w = window.innerWidth;
      const h = window.innerHeight;
      canvas.style.width = w + "px";
      canvas.style.height = h + "px";
      canvas.width = w * dpr;
      canvas.height = h * dpr;
      ctx.scale(dpr, dpr);
    };
    setSize();
    window.addEventListener("resize", setSize);

    let animationFrame;
    let lastDraw = 0;
    const fps = 12;
    const interval = 1000 / fps;

    const drawNoise = () => {
      const w = window.innerWidth;
      const h = window.innerHeight;
      ctx.fillStyle = "#f5f5dc";
      ctx.fillRect(0, 0, w, h);

      const dotCount = 4000;
      for (let i = 0; i < dotCount; i++) {
        const x = Math.random() * w;
        const y = Math.random() * h;
        const radius = Math.random() * 2 + 0.5;
        const alpha = Math.random() * 0.3 + 0.5;
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(0,0,0,${alpha})`;
        ctx.fill();
      }
    };

    const loop = (now) => {
      if (now - lastDraw > interval) {
        drawNoise();
        lastDraw = now;
      }
      animationFrame = requestAnimationFrame(loop);
    };

    let hasStarted = false;

    const startAnimation = () => {
      if (hasStarted) return;
      hasStarted = true;
      setShowCanvas(true);
      animationFrame = requestAnimationFrame(loop);
      window.removeEventListener("scroll", startAnimation);
      window.removeEventListener("wheel", startAnimation);
    };

    window.addEventListener("scroll", startAnimation);
    window.addEventListener("wheel", startAnimation);

    // fallback in case scroll never happens
    const timeout = setTimeout(startAnimation, 3000);

    return () => {
      cancelAnimationFrame(animationFrame);
      clearTimeout(timeout);
      window.removeEventListener("resize", setSize);
      window.removeEventListener("scroll", startAnimation);
      window.removeEventListener("wheel", startAnimation);
    };
  }, []);

  // Load more widgets on intersection
  useEffect(() => {
    if (!loadMoreRef.current || visibleCount >= widgets.length) return;

    const observer = new IntersectionObserver(
      (entries) => {
        if (entries[0].isIntersecting) {
          setVisibleCount((prev) => Math.min(prev + 1, widgets.length));
        }
      },
      { rootMargin: "200px" }
    );
    observer.observe(loadMoreRef.current);
    return () => observer.disconnect();
  }, [visibleCount]);

  // Custom smooth scroll snap on wheel
  useEffect(() => {
    let isScrolling = false;

    const handleWheel = (e) => {
      if (isScrolling) {
        e.preventDefault();
        return;
      }

      const delta = e.deltaY;
      if (delta === 0) return;

      isScrolling = true;
      e.preventDefault();

      let currentIndex = sectionRefs.current.findIndex((section) => {
        const rect = section.getBoundingClientRect();
        return rect.top >= -50 && rect.top <= 50;
      });

      if (currentIndex === -1) {
        currentIndex =
          sectionRefs.current.findIndex((section) => {
            const rect = section.getBoundingClientRect();
            return rect.top > 0;
          }) - 1;
        if (currentIndex < 0) currentIndex = 0;
      }

      let nextIndex;
      if (delta > 0) {
        nextIndex = Math.min(currentIndex + 1, sectionRefs.current.length - 1);
      } else {
        nextIndex = Math.max(currentIndex - 1, 0);
      }

      if (nextIndex !== currentIndex) {
        sectionRefs.current[nextIndex].scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }

      setTimeout(() => {
        isScrolling = false;
      }, 1000);
    };

    window.addEventListener("wheel", handleWheel, { passive: false });

    return () => {
      window.removeEventListener("wheel", handleWheel);
    };
  }, []);

  useEffect(() => {
    const loader = document.getElementById("loader");
    const onAnimEnd = (e) => {
      if (e.animationName === "slideUp") loader.remove();
    };
    loader?.addEventListener("animationend", onAnimEnd);
    return () => loader?.removeEventListener("animationend", onAnimEnd);
  }, []);

  return (
    <>
      <div id="loader">
        <svg
          className="logo-loader"
          xmlns="http://www.w3.org/2000/svg"
          id="Layer_1"
          data-name="Layer 1"
          viewBox="0 0 967.39 959.06"
        >
          <g>
            <path
              class="cls-1"
              d="M664.29,39.96c-12.57,39.77-20.02,83.99-33.55,123.11-1.33,3.84-2.21,8.55-7.35,8.47-3.43-.04-33.72-8.16-36.66-9.92-3.77-2.28-5.91-6.48-7.04-10.63l-21.55-85.12-21.75,77.97c-3.55,4.72-34.1-4.08-35.16-5.55-1.53-2.11-1.36-6.99-.83-9.59l31.27-121.49,2.47-3.84c3.55-1.81,23.78,3.67,29.07,5.05,12.43,3.24,15.09,1.27,19.55,14.53,8.42,24.96,13.18,53.41,20.77,78.96.5,1.7.11,3.91,2.58,4.36l19.07-77.23,3.31-3.56c1.94-.29,30.69,7.26,32.84,8.56,2.95,1.78,2.97,2.36,2.97,5.95Z"
            />
            <path
              class="cls-1"
              d="M222.01,207.56c-9.73,58.17-74.94,91.45-123.41,50.84-54.99-46.09-19.13-138.09,52.39-130.66,4.28.44,9.54.59,9.56,5.61,0,2.98-8.69,31.98-10.11,32.94-4.29,1.35-8.79.13-13.17.72-28.16,3.75-34.34,36.02-15.48,54.95,10.29,10.33,28.25,18.13,42.47,12.43,12.06-4.83,25.05-25.63,15.79-37.22-4.39,3.08-17.67,19.87-21.54,20.25-1.21.11-2.01-.19-3.07-.69-1.01-.47-16.27-13.37-17.14-14.43-1.22-1.45-2.08-2.34-1.88-4.44l47.39-48.36c2.13.52,3.5,2.15,5.11,3.45,5.67,4.57,25.7,25.61,30.29,31.56,5.74,7.45,4.33,14.01,2.8,23.06Z"
            />
            <path
              class="cls-1"
              d="M349.66,148.82l-45.26-31.22c-.45-2.65,2.3-3.66,3.57-5.87,9.97-17.26,8.28-38.97-4.81-54.11-31.55-36.45-81.36,3.22-114.55,16.8-6.39,3.74-3.5,8.1-1.44,13.34,14.47,36.71,39.9,73.5,54.67,110.71,2.83,4.75,3.41,6.02,9.19,4.01,2.71-.93,22.42-11.37,24.76-13.1,1.68-1.25,3.52-2.73,4.09-4.82,1.45-5.44-15.72-32.85-18.28-39.83,2.42-2.21,6.4-5.14,9.88-3.79,6.98,2.7,22.37,16.83,29.98,21.88,5.79,3.84,9.29,8.02,16.84,5.96,2.79-.77,29.41-14.01,30.32-15.45.8-1.26,1.39-3.06,1.02-4.52ZM246.44,115l-12.75-26.4c12.19-3.72,25.03-17.33,36.64-4.44,14.57,16.18-10.96,28.14-23.88,30.84Z"
            />
            <path
              class="cls-1"
              d="M403.86.58c-88.28,9.51-85.89,147.27,9.75,146.16,101.64-1.19,95.22-157.46-9.75-146.16ZM418.51,109.9c-45.89,5.28-50.77-68.25-10.89-74,46.54-6.73,52.95,69.17,10.89,74Z"
            />
            <path
              class="cls-1"
              d="M805.23,169.66c-6.88,0-17.14,2.94-18.57-4.73-.77-4.17.62-8.53-.62-13.27-2.07-7.89-16.49-22.16-24.34-14.77-.82.77-2.73,5.44-2.8,6.69-.47,7.22,22.48,33.33,25.89,45.94,6.19,22.93-5.73,43.64-28.44,49.94-32.36,8.99-65.7-18.91-78.11-46.91-2.27-5.13-7.01-15.09-3.43-19.48,2.99-3.67,26.98-11.29,31.43-9.82,3.12,1.02,4.66,11.65,6.21,15.29,3.67,8.67,13.97,26.3,24.31,26.31,4.83,0,10.39-3.02,10.72-8.42.47-7.8-27.32-35.69-29.04-52.92-1.12-11.29,3.67-23.51,10.84-32.09,28.97-34.67,88.55,5.35,93.61,42.51,2.63,19.26-5.02,15.74-17.67,15.74Z"
            />
            <path
              class="cls-1"
              d="M670.52,841.62c13.6-20.19-2.44-48.97-26.79-47.04-10.14.8-47.93,17.95-58.68,23.44-2.26,1.15-5.25,1.68-5.53,4.66l43.97,103.78c1.48,3.86,4.62,3.17,7.9,2.28,8.9-2.41,46.86-19.9,54.16-25.37,27.09-20.34,20.63-61.48-15.04-61.76ZM626.33,849.81l-6.34-17.66c7.52-.3,16.26-10.62,23.63-4.67,12.25,9.87-9.15,20.55-17.29,22.33ZM644,892.74l-7.06-20.26c8.58-2.36,19.86-11.26,27.89-5.01,16.01,12.47-10.83,23.01-20.83,25.27Z"
            />
            <path
              class="cls-1"
              d="M191.74,764.29c-15.72,2.16-30.56,13.46-39.35,26.31-45.91,67.13,50,134.37,95.72,71.73,33.44-45.81-2.27-105.46-56.37-98.04ZM179.85,848.11c-19.93-18.53,4.52-62.74,34.31-50.09,36.21,15.38-1.34,80.73-34.31,50.09Z"
            />
            <path
              class="cls-1"
              d="M287.52,807.12c-3.32.63-5.15,8.48-6.19,11.42-9.2,26.28-20.11,59.99-26.8,86.82-1.7,6.87-4.65,10.72,3.14,14.52,39.78,19.4,91.98,26.36,108.21-25.61,18.67-59.75-32.53-74.67-78.37-87.14ZM335.35,880.15c-5.15,21.85-23.48,31.02-43.5,19.37l15.12-54.73c20.45,3.21,33.66,12.98,28.38,35.36Z"
            />
            <path
              class="cls-1"
              d="M455.88,914.19h-18.3c-.22,0-3.16-2.93-3.16-3.16v-20.2c0-.35,1.29-2.94,2.13-3.2,9.27-.91,18.43.83,27.49,1.36,4.97.29,20.34-1.66,22.78,2.45l-2.26,47c-23.03,30.35-83.71,27.16-99.6-9.52-21.21-48.97,13.08-102.83,68.65-90.11,8.1,1.85,31.47,13.96,31.28,23.01-.06,2.72-18.16,13.63-21.1,14.26-7.16,1.54-8.33-5.36-14.22-8-11.3-5.05-26.38-.31-32.26,10.68-7.2,13.42-6.94,42.11,9.16,49.04,12.42,5.34,31.78,4.19,29.4-13.62Z"
            />
            <path
              class="cls-1"
              d="M143.83,694.14c-3.36-4.67-18.27-25.06-22.93-24.59l-84.05,59.8c-5.67,4.32-3.37,7.83-.39,12.84,22.6,38,60.15,76.25,104.41,40.69,33.97-27.28,25.26-57.73,2.95-88.73ZM81.55,756.42c-1.16-1.25-9.92-13.2-9.43-13.89l46.38-31.41c4.56-1.12,12.54,11.92,13.65,16.16,7.44,28.44-29.72,51.44-50.6,29.14Z"
            />
            <path
              class="cls-1"
              d="M822.05,806.32c-.3-3.31-10.79-9.15-14.06-11.31-24.96-16.52-56.73-36.87-82.83-50.99-1.99-1.07-6.49-3.95-8.4-3.77-3.4.33-31.04,23.67-31.09,26.85l41.38,108.84c1.16,2.55,2.83,4.47,5.83,4.2,1.43-.13,22.09-15.25,22.82-16.45,3.19-5.18-5.9-17.48-6.74-23.17l26.28-22.96c3.11-1.45,15.64,13.61,21.84,11.87,1.43-.4,21.74-17.02,23.09-18.66,1.15-1.39,2.16-2.45,1.87-4.46ZM740.54,818.24l-18.28-38.5,2.5-.61c.19,3.24,5.09,4.46,7.99,6.53,8.03,5.74,15.83,11.93,23.57,18.08l-15.78,14.51Z"
            />
            <path
              class="cls-1"
              d="M571.72,852.04l-40.1,9.15,3.73,15.87c2.35,1.8,28.58-6.61,34.21-5.25,6.17,1.49,8.8,17.59,7.28,22.57-1.87,6.12-29.84,7.31-36.24,9.82l2.49,17.47c2.34,2,33.97-8.04,40.69-5.98,3.85,1.18,8.2,22.38,6.6,25.03-.79,1.31-2.79,1.7-4.18,2.15-12.26,4-48.35,10.36-61.66,11.56-2.71.25-5.51.7-8.13-.41l-19.5-113.07,66.64-14.89c2.06.47,3.41,1.24,4.41,3.19,1.71,3.34,6.53,20.14,3.77,22.78Z"
            />
            <path
              class="cls-1"
              d="M890.14,650.35c3.59-8.18,12.06-39.3,17.72-43.52,5.37-4,26.36,4.75,26.15,11.11l-27.17,71.19c-1.93,3.91-6.51,5.05-10.38,3.55-32.06-14.85-67.64-25.57-99.31-40.85-5.58-2.69-8.57-2.46-8.06-9.68.27-3.8,11.41-26.38,14.56-26.72l86.49,34.92Z"
            />
            <path
              class="cls-1"
              d="M761,688.38c1.45-.43,2.84-.35,4.14.46l71.35,53.61c2.9.03,24.92-37.86,29.3-38.95,2.71-.67,21.87,13.71,21.62,16.67l-42.73,62.08c-1.63,2.3-3.73,3.92-6.64,2.99l-93.17-68.53c-1.88-2.18-1.28-4.27-.22-6.7.9-2.06,15.04-21.24,16.34-21.63Z"
            />
            <path
              class="cls-1"
              d="M676.51,112.23c-8.89-3.24-9.92-11.6-1.04-14.25,3.02-.91,21.44-.27,16.25-9.18-.28-.48-4.19-1.83-5.91-4.81-13.13-22.89,20.63-42.27,33.73-19.84,13.95,23.88-18.6,57.04-43.04,48.09Z"
            />
          </g>
          <g>
            <path
              class="cls-1"
              d="M81.34,625.58c1.46-.18,3.54-.58,4.77.39,3.23,5.89-4.92,11.11-9.17,14.06-17.12,11.88-44.26,26.87-63.39,35.17-2.27.99-16.73,7.54-12.91.47,2.66-4.92,27.85-20.98,34.05-24.96,9.71-6.25,36.47-23.85,46.66-25.13Z"
            />
            <path
              class="cls-1"
              d="M102.64,563.53c3.34-.48,6.71.03,5.37,4.15-3.49,10.68-45.63,31.24-56.74,37.56-3,1.71-13.81,9.33-16.24,9.07-1.56-.16-3.31-1.82-2.54-3.49.33-.72,6.48-6.6,7.62-7.62,6.33-5.7,14.7-11.66,21.72-16.6,8.34-5.87,31.66-21.75,40.81-23.08Z"
            />
            <path
              class="cls-1"
              d="M730.34,346.49c-87.76-154.04-315.94-173.95-421.73-27.75-4.89,6.75-12.67,17.38-16.05,24.71-3.59,7.78,4.67,8.81,9.54,12.57,7.8,6.05,16.13,17.53,17.94,27.37-1.26-.01-2.55.14-3.81-.14-4.81-1.07-15.4-14.09-19.91-17.81-21.8-18.05-58.73-17.76-84.86-11.2-25.74,6.48-47.09,22.19-69.08,36.17-5.14,1.57-16.08-4.03-22.26-4.58-21.5-1.91-30.05,6.99-47.14,16.12-19.62,10.48-53.24,18.78-49.92,47.13.95.16,1.4-.11,2.16-.59,2.84-1.82,6.51-8.26,10.06-11.22,6.21-5.23,26.08-17.02,33.78-17.91,2.4-.29,7.62-.73,7.61,2.66-.01,3.93-12.36,9.48-15.72,11.72-13.79,9.17-37.92,30.71-29.69,49.4,1.39,3.14,7.06,9.54,10.83,8.42,2.25-.67,6-11.83,7.42-14.52,8.03-15.15,30.02-34.27,47.48-36.47,3.11-.39,6.85.28,10.04,0l-.62,2.73c-17.62,13.51-41.67,21.61-47.28,45.79-4.62,19.91,8.67,19,20.51,8.96,14.85-12.59,22.53-25.92,40.59-36.69,6.8-4.06,29.15-16.75,31.17-2.2,1.44,10.35-7.56,16.99-8.46,27.94-1.44,17.67,11.78,12.52,19.11,3.28,12.32-15.53,14.06-49.3,1.58-65.3-.14-4.25,15.35-11.5,19.05-13.2,29.36-13.42,81.55-27.8,106.29.43,2.52,2.89,13.36,18.27,13.42,21.25.06,2.83-.72,5.11-3.83,4.46-6.45-1.34-16.02-11.21-23.14-13.38-1.58-.49-3.02-.69-4.67-.44-.63,5.19-1.77,10.36-2.39,15.55-19.82,166.75,143.78,301.12,304.33,266.38,158.94-34.38,237.91-218.64,157.61-359.61ZM286.34,492.2c.53-.11,1.67,0,2.11.3l1.17,14.95c-7.68,3.09-4.78-14.91-3.28-15.25ZM295.54,538.33c-1.55-4.13-6.94-18.37.74-18.09l7.33,25.51c-4.62.58-6.69-3.71-8.08-7.42ZM313.66,571.33c-6.1-2.74-5.23-11.72,2.13-10.97-1.48,2.17.78,11-2.13,10.97ZM609.12,262.98c1.07-.1,1.99-.04,3.02.34,2.35.87,13.03,10.89,10.98,13.04-1.5,1.57-16.22-9.05-14-13.38ZM577.47,252.66c6.82.2,14.24,4.62,19.67,8.62,3.56,2.61,8.45,5.98,8.33,10.83-1.25.1-2.32.03-3.5-.47-3.62-1.49-16.95-10.31-20.43-13.03-2.17-1.69-4.54-2.64-4.08-5.96ZM461.08,431.58c3.07-.57,14.98-.62,18.15-.18,1.58.21,1.93,1.16,3.31,1.25.93-1.04-4.04-11.73-4.58-13.97-3.47-14.49,1.46-35.02,8.74-47.86,2.7-4.76,13.27-19.48,18.68-19.71,5.57-.23,2.51,4.2.9,6.74,5.83-4.06,19.06-11.68,26.17-10.95-4.8-4.24-10.63-8.17-16.11-11.56-6.22-3.86-13.44-8.17-20.25-10.79-10.33-3.99-30.1-5.95-18.92-22.24,3.66-5.34,9.38-5.78,15.41-5.25,23.66,2.03,69.52,37.56,84.61,55.92,6.45,7.85,11.42,16.92,17.69,24.88,2.88,3.66,7.6,11.5,12.46,7.69,5.92-4.65,4.51-17.89,4.25-25-.05-1.36-.62-2.56-.63-3.91,1.59-1.57,5.97,5.4,6.58,6.5,11.77,21.31-3.76,55.81-30.92,42.14,2.39,25.69-10.53,52.67-33.37,65.18-1.09,1.86,2.89,6.25,2.93,8.4-2.25,1.98-14.43-6.17-16.87-7.76-17.71-11.53-29.73-21.08-51.04-26.84-10.16-2.75-21.37-2.8-30.97-5.54-4.25-1.22-.04-6.45,3.77-7.13ZM447.09,255.19c5.62-1.12,8.87,6.99,2.9,7.12-4.94.11-7.62-6.19-2.9-7.12ZM341.01,348.69c.81-3.81,8.66-17.06,11.93-19.09,1.41-.87,2.54-1.12,4.23-.93l-13.95,25.17c-3.19,1.53-2.68-2.93-2.21-5.15ZM339.52,322.58c2.2,2.2-9.9,12.71-9.19,16.35l-4.19.08c-2.02-2.06,8.43-18.17,13.38-16.42ZM321.27,576.16l2.64.1,11.36,23c-8.77-1.69-14.19-14.97-14-23.1ZM347.43,602.03c-6.51-1.79-16.12-21.44-17.81-27.82-.35-1.36-1.67-6.29-.37-7.11.61-.38,2.12-.13,2.68.54.68.81,3.98,11.07,5.25,13.61,3.56,7.04,8.62,13.27,13.26,19.61-.16,1.83-1.63,1.55-3,1.17ZM355.9,360.83l-4.2.06c-1.36-1.36,2.8-14.47,7.31-12.78.44,4.56-2.28,8.41-3.11,12.71ZM362.52,300.24c-1.1,5.4-11.93,9.9-12.03,5.02-.05-2.47,6.61-7.62,8.95-8.09,2.76-.57,3.65.3,3.08,3.07ZM379.01,621.7c-4.06,3-10.19-8.53-8.45-10.26,5.35-.98,8.72,5.62,8.45,10.26ZM375.73,282.45c-2.63-4.3,8.6-8.75,9.44-7.92,2.47,4.76-6.98,11.98-9.44,7.92ZM441.69,268.39c-4.42,2.47-9.54,3.21-14.42,1.48-8.34-2.95-4.38-13.24,4.89-10.35,2.29.71,10.79,6.69,9.53,8.87ZM478.51,683.72c-5.5.53-15.39.53-16.06-6.62,7.32-.1,14.66,1.29,21.3,4.27,1.38,1.45-4.6,2.28-5.24,2.35ZM503.36,680.57c4.76-1.99,10.1-2.3,15.09-3.47.4,4.6-7.69,7.44-11.32,7.84-5.11.58-10.86-1.39-3.76-4.37ZM534.07,688.77c-3.84,1.72-16.59,6.29-20.29,6.39-3.13.08-5.06-2.94-2.8-5.29l31.8-8.5c2.36,2.41-7.12,6.69-8.71,7.4ZM606.69,658.86c-.04-.83-.09-1.65.3-2.44.42-.82,10.01-7.23,11.24-7.64.85-.29,1.54-.54,2.18.32,3.45,5.21-9.66,10.97-13.72,9.76ZM495.1,602.82c-38.76-17.5-63.73-66.76-48.48-107.86,4.77-12.88,13.76-25.31,28.49-26.86,22.77-2.41,50.16,19.72,70.3,29.11,23.43,10.93,58.85,21.07,84.73,19.38,10.68-.69,22.82-5.63,33.4-5.52,4.06.05,5.95.77,5.06,5.05-2.35,11.45-24.76,11.39-33.33,14.73-24.02,57.15-75.97,100.98-140.19,71.97ZM643.01,641.33c-10.17,4.68-3.35-7.84,2.46-9.1,6.44-1.41,2.63,6.77-2.46,9.1ZM670.68,631.88c-1.15.67-5.11,2.69-4.87.03.24-2.52,7.84-11.61,9.95-13.8.63-.66,1.07-1.43,2.13-1.21.73,5.74-2.2,12.04-7.21,14.98ZM679.3,469.02c-6.4,3.62-16.83,4.54-21.46,7.74-2.37,1.63-3.77,5.88-5.81,8.19-6.17,7.01-22.99,12.69-31.04,6.68-4.2-3.14-3.32-4.01.69-5.98,8.21-4.04,22.05-6.98,23.28-18.1.98-8.96-4.65-18.41-14.69-16.51-3.27.62-13.67,7.61-15.97,2.9-2.42-8.48,12.67-15.68,19.16-16.42-.77-10.55-6.79-24.34-3.04-34.67-4.13-.98-5.73-2.65-6.07-6.99-1.72-22.13,37.22-58.46,56.43-65.83,7.36-2.82,17.42-4.89,22.93,2.35,9.51,12.47-15.62,19.01-21.78,23.73-.56.42-1.04.66-1.04,1.46-.09,1,.29,1.46.93,2.15,1.43,1.5,6.82,4.1,9.14,6.06,30.53,25.84,22.24,84.01-11.66,103.25ZM722.64,571.3c-4.51-3.21,1.55-17.22,5.55-17.57.95-.19,1.33.69,1.45,1.46.39,2.54-4.15,16.75-7.01,16.11Z"
            />
            <path
              class="cls-1"
              d="M906.41,482.5c-10.74.62-21.73-5.42-31.64-4.24-1.87.21-4.57.59-3.88,2.95,3.72,2.23,8.57,6.44,5.67,11-2.37,3.72-13.29,11.4-17.38,14.25-24.92,17.37-54.57,28.59-85.12,30.16l6.82-42.43c16.06-5.43,33.06-11.58,46.92-21.52,3.51-2.51,15.35-12.35,16.13-16.15,1.29-6.24-8.89-11.58-12.69-15.65-12.89-13.8-21.85-41.44-9.1-57.77,17.45-22.32,53.92,1.64,55.96,24.93,1.64,18.6-11.72,19.02-24.74,11.34-2.98-1.77-17.12-14.71-19.67-12.26,2.18,19.14,26.33,33.98,44.42,27.37l-4.87,23.71c3,.66,5.49-2.45,7.28-4.58,3.88-4.6,7.3-11.21,9.77-16.7,1.16-.83,7.83,7.94,9.42,9.11,20.46,15.11,49.84-11.31,48.38-33.44-2.41-2.51-13.33,13.6-14.88,15.22-6.51,6.78-18.65,14.33-27.12,6.38-8.45-7.93-.77-23.95,4.63-31.88,11.78-17.28,38.6-37.97,52.1-10.2,17.37,35.76-17.69,88.18-56.42,90.4Z"
            />
            <path
              class="cls-1"
              d="M299.39,639.68c-.25,1.55-5.33,4.37-6.93,5.29-16.39,9.49-51,21.22-68.98,13.39-12.31-5.35-24.33-30.35-27.75-42.82-1.2-4.38-3.57-22.96-6.17-24.84-1.57-1.12-4.51-.4-6.41-.53-.97,6.35-1.38,12.67-.56,19.05.53,4.18,3.43,10.2,1.14,13.46-9.32,13.2-49.9,36.43-57.84,12.19-9.8-29.92,29.96-69.27,52.18-84.76,9.34-6.5,27-17.17,38.53-13.79,10.76,3.16,15.6,18.1,13.31,28.19-5.53.87-18.46,2.3-22.09,6.8-2.01,2.5-1,6.93,2.46,7.26,5.9.56,13.62-5.62,20.91-.87,5.29,3.43,7.55,14.68,7.93,20.65.8,12.32-5.54,5.2-9.13,11.53-2.98,5.24.39,10.79,5.95,11.73,16.37,2.75,31.95-7.35,46.12-13.79l16.85,29.3.5,2.55Z"
            />
            <path
              class="cls-1"
              d="M392.39,710.48c-.32.49-9.51,4.14-10.89,4.61-25.16,8.31-48.69,2.45-72.2-7.47-1.74-.73-11.12-6.64-11.77-3.43-.69,3.47,9.99,12.35,9.73,13.34-12.7,9.85-36.7,26.65-53.36,21.12-5.79-1.93-10.67-7.49-10.55-13.77.29-14.71,22.37-36.89,33.55-45.57,10.49-8.16,22.55-14.68,35.84-16.79-1,2.49,2.47,5.79,2.31,7.51-.24,2.54-8.55,8.18-1.31,11.87,6.98,3.56,11.48-6.43,16.97-6.65,3.47-.14,14.13,7.7,18.33,9.68,5.34,2.52,11.18,3.99,16.46,6.67,8.58,4.36,17.24,10.89,25.72,15.65,1.04.47,1.73,2.35,1.17,3.24Z"
            />
            <path
              class="cls-1"
              d="M934.09,367.85c-16.1,6.26-27.34,19.26-36.76,33.23l-6.44,13.33c-.25-3.02.35-6.49,0-9.43-.91-7.66-6.34-15.94-10.23-22.4,7.02-15.73,20.77-32.44,40.03-25.63,5.01,1.77,11.21,5.95,13.39,10.89Z"
            />
            <path
              class="cls-1"
              d="M894.25,346.91c-10.26,5.64-17.96,15.3-22.27,26.11l-20.97-9.68c-1.96-3.11,6.75-12.06,9.17-13.99,8.57-6.85,24.26-11.84,33.44-3.65.34.3,1.2.8.63,1.21Z"
            />
            <path
              class="cls-1"
              d="M574.14,388.25c-23.63-13.92-37.37,17.91-34.22,37.24,1.87,11.49,9.58,21.31,20.51,25.4.59.82-2.92,3.26-3.71,3.89-2.9,2.35-8.99,6.73-12.74,5.58-10.74-7.79-20.65-15.59-33.3-20.26-8.27-3.06-12.71-1.67-16.87-11.11-8.13-18.48-4.71-46.77,6.49-63.42,1.87-2.78,4.13-4.82,5.97-7.71,5.83-4.06,19.06-11.68,26.17-10.95,1.07.11,1.53.47,2.39.95,9.13,5.07,32.25,25.9,37.68,34.73.9,1.46,2.46,4.05,1.63,5.67Z"
            />
            <path
              class="cls-1"
              d="M695.85,402.84c-15.64-16.51-35.95-10.15-38.02,13.09-1.5,16.78,4.01,32.9,20.06,40.12-.01,2.05-14.83,9.11-17.64,9.43-.29-11.98-6.26-24.34-18.73-27.19-2.27-.53-5.77-1.04-8.05-.78-.77-10.55-6.79-24.34-3.04-34.67,3.33-9.13,22.37-27.07,30.49-33.09,1.53-1.12,10.88-7.59,11.8-7.62,1.09-.04,3.79,1.78,4.77,2.51,7.46,5.49,19.58,27.42,19.3,36.67-.03.92.4,1.78-.93,1.53Z"
            />
            <path
              class="cls-1"
              d="M551.28,594.06c-3.77,2.61-22.95,1.53-28.1.78-31.03-4.47-52.39-24.6-64.04-52.76-1.59-3.83-3.45-7.79-2.66-12.04,32.97-11.92,69.08,16.11,74.17,48.54l2.37-.03c1.98-7.54,5.3-14.4,3.09-22.47,6.93,5.43,13.14,17.13,15.38,25.68.74,2.84,2.36,10.53-.2,12.3Z"
            />
            <path
              class="cls-1"
              d="M609.12,526.3c-1.99,5.3-7.81,11.93-13.07,14-9.63,3.8-30.26,1.88-40.5-.32-26.6-5.71-50.67-23.25-55.37-51.38,2.94-.19,5.68,1.21,8.32,2.32,10.89,4.54,20.98,11.39,31.62,16.44,21.22,10.06,45.59,17,68.99,18.94Z"
            />
          </g>
        </svg>
      </div>

      <main className="flex flex-col w-full min-h-screen overflow-hidden relative text-black">
        <canvas
          ref={canvasRef}
          className={`fixed top-0 left-0 w-full h-full z-40 pointer-events-none transition-opacity duration-700 ease-in-out ${
            showCanvas ? "opacity-[0.05]" : "opacity-0"
          }`}
          style={{ mixBlendMode: "normal" }}
        />

        {/* hero section */}
        <div ref={heroRef}>
          <NavBar />

          {/* Updated Widget Grid */}
          <div className="grid grid-cols-12 relative z-50 gap-4 grid-flow-dense auto-rows-[72px] mx-auto md:mt-40 mb-40 max-w-[336px] md:max-w-[688px]">
            {widgets.slice(0, visibleCount).map((w, i) => (
              <Widget
                key={w.id}
                col={w.col}
                row={w.row}
                innerRef={(el) => (tileRefs.current[i] = el)}
              >
                {w.component}
              </Widget>
            ))}
            {visibleCount < widgets.length && (
              <div ref={loadMoreRef} className="col-span-12 h-1" />
            )}
          </div>
        </div>

        {/* Content Sections with refs */}
        <div className="relative">
          <div id="partner" className="min-h-[100vh]" ref={addToSectionRefs}>
            <Partners />
          </div>
          <div
            id="about"
            className="bg-[#f1eee7] min-h-[100vh]"
            ref={addToSectionRefs}
          >
            <About />
          </div>
          <div id="sessions" className="min-h-[100vh]" ref={addToSectionRefs}>
            <UpcomingSessions />
          </div>
          <div
            id="memberships"
            className="min-h-[100vh]"
            ref={addToSectionRefs}
          >
            <PricingPlans />
          </div>
          <div
            id="funds"
            className="bg-[#f1eee7] min-h-[100vh]"
            ref={addToSectionRefs}
          >
            <FundsAccessibility />
          </div>
          <div
            id="sponsors"
            className="min-h-screen flex items-center justify-center"
            ref={addToSectionRefs}
          >
            <Sponsors />
          </div>
          <div
            id="locations"
            className="bg-[#f1eee7] min-h-[100vh]"
            ref={addToSectionRefs}
          >
            <Locations />
          </div>
          <div id="reviews" className="min-h-[100vh]" ref={addToSectionRefs}>
            <Reviews />
          </div>
          <div id="faq" className="min-h-[100vh]" ref={addToSectionRefs}>
            <FAQ />
          </div>
          <div
            id="contact"
            className="bg-[#f1eee7] min-h-[100vh]"
            ref={addToSectionRefs}
          >
            <ContactForm />
          </div>
          <div id="footer" ref={addToSectionRefs}>
            <Footer />
          </div>
        </div>
      </main>
    </>
  );
}
